

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gus2.gus_roles.models &mdash; gus v0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="gus v0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">gus v0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for gus2.gus_roles.models</h1><pre>
from django.db import models
from django.contrib.auth.models import Group
from gus2.gus_groups.models import gus_group
from gus2.gus_users.models import gus_user
# Create your models here.

<div class="viewcode-block" id="RoleManager"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.RoleManager">[docs]</a>class RoleManager(models.Manager):
<div class="viewcode-block" id="RoleManager.create_role"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.RoleManager.create_role">[docs]</a>    def create_role(self,group,role_name):
        """
        this will create a new role and insert it into the table
        
        @type group:gus_groups.models.gus_group
        @param group: the group to associate with the role
        @rtype:gus_roles.models.gus_role
        @return: the newly created role
        
        Example
            &gt;&gt;&gt;gus_roles.objects.create_role(&lt;gus_group object&gt;,'group_name')
            (&lt;gus_role object&gt;)
        """
        django_grp = Group.objects.create(    
                name="%s.%s" % (group.group_name,role_name)
                )
        newrole= gus_role.objects.create(
            _role_permissions= django_grp,
            _role_group=group,
            _role_name =role_name
            )                                                            
        
        return newrole
        
    </div>
<div class="viewcode-block" id="RoleManager.with_user_in_group"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.RoleManager.with_user_in_group">[docs]</a>    def with_user_in_group(self,group,user):
        """
        will return 1 role or false depending on if the given user 
        has a role in the given group
        
        @type group:gus_groups.models.gus_group
        @param group: the group in question
        @type group:gus_groups.models.gus_user
        @param group: the user in question
        """
        return super(RoleManager, self).get_query_set().filter(
                _role_users=user,
                _role_group=group,
        )
    </div>
<div class="viewcode-block" id="RoleManager.with_user"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.RoleManager.with_user">[docs]</a>    def with_user(self,user):
        """
        will return all roles of a given user
        """
        return super(RoleManager, self).get_query_set().filter(
                _role_users=user,
        )</div>
<div class="viewcode-block" id="RoleManager.users_without_group"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.RoleManager.users_without_group">[docs]</a>    def users_without_group(self,group):
        #roles_in_group
        roleswgrp = self.with_group(group);
        id_list = []
        for role in roleswgrp:
            id_list.extend(map(lambda x: x.id , role.users.all()))
        return gus_user.objects.exclude(_user__in=id_list)
        </div>
<div class="viewcode-block" id="RoleManager.users_with_group"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.RoleManager.users_with_group">[docs]</a>    def users_with_group(self,group):
        """
        will return a list of users in a given group
        """
        roleswgrp = self.with_group(group);
        id_list = []
        for role in roleswgrp:
            id_list.extend(map(lambda x: x.id , role.users.all()))
        return gus_user.objects.filter(_user__in=id_list)
        #usrs = []
        #for role in roleswgrp :
        #    usrs.extend(role.users.all()) 
        #return usrs 
            </div>
<div class="viewcode-block" id="RoleManager.with_group"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.RoleManager.with_group">[docs]</a>    def with_group(self,group):
        """
        will return all roles of a given group
        """
        return super(RoleManager, self).get_query_set().filter(
                _role_group=group,
        )
    
    
    

        </div></div>
<div class="viewcode-block" id="gus_role"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.gus_role">[docs]</a>class gus_role(models.Model):
    """
    class gus_role  is our model of a groupRole
    it shall encompass both the data and discreet functionality of groupRoles
    GroupRoles are used to tie users and groups together 
    and to provide permissions within a group context    
    """
    
    
    ###############################################
    ####   Model Fields ###########################
    ###############################################
    
    # double underscore is essentially a private variable
    _role_users = models.ManyToManyField(gus_user) #ManyToMany relationship....
    
    #since django's built in groups are simillar to our roles we will
    
    #simply make our permissions an instance of traditional group permisions
    _role_permissions = models.OneToOneField(Group)
    
    #essentially ManyToOne Relationship
    _role_group = models.ForeignKey(gus_group) 
    
    #textual name of the role (ie:Admin,User,etc)
    _role_name = models.CharField(max_length=100)
    
    #we can use this for special flags
    _role_permission_level = models.IntegerField(default=0)
    
    #################################################
    #### Gus Roles Specific Functions       #########
    #################################################
<div class="viewcode-block" id="gus_role.addUser"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.gus_role.addUser">[docs]</a>    def addUser(self,user):
        """
        this will add a user to a role
        @type user:gus_users.models.gus_user
        @param user:the user to add to the role
        @rtype: gus_roles.models.gus_role
        @return: the role , with the new user added to the list  
        """
        self._role_users.add(user)</div>
<div class="viewcode-block" id="gus_role.removeUser"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.gus_role.removeUser">[docs]</a>    def removeUser(self,user):
        """
        this will remove a user from a role
        @type user:gus_users.models.gus_user
        @param user:the user to add to the role
        @rtype: gus_roles.models.gus_role
        @return: the role , with the user removed from the list  
        """
        self._role_users.remove(user)
    
    #################################################
    ####  Python Magic Functions       ##############
    #################################################
    </div>
    objects = RoleManager() #defines custom associations                                            
<div class="viewcode-block" id="gus_role.permString"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.gus_role.permString">[docs]</a>    def permString(self):
        """
        return a list of permissions associated with this role
        """
        perms = self._role_permissions.permissions.all()
        if not perms.count() : return ""
        permList = [] 
        for perm in perms:
            permList.append(perm)
        return " '%s'" % "', '".join(permList);
    
    #define how to display our object in the html</div>
    def __unicode__(self):
        """
        This defines the default display of a role
        for now we will just return the default django.User display
        
        @rtype:   string
        @return:  the default string for built in django.User.
        """
        
        return 'Role :[%s] %s '%(self._role_group.group_name,self._role_name) 
    
    
    ################################################
    ###   Getters And Setters ######################
    ################################################
    #Define our setters , syntax is:def setProperty(self): ... 
    #    s.t. Property is the name of the property you wish to use 
    #  a setter for , with the first letter capitalized
    
    #setter for our user
<div class="viewcode-block" id="gus_role.setUsers"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.gus_role.setUsers">[docs]</a>    def setUsers(self,user):
        """
        return an error about being read only
        """
        raise Exception, "RoleUsersPermisionError: This Property is read Only"</div>
<div class="viewcode-block" id="gus_role.setGroup"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.gus_role.setGroup">[docs]</a>    def setGroup(self):
        """
        return an error about being read only
        """
        raise Exception, "RoleUsersPermisionError: This Property is read Only"
    #Define our getters , syntax is:def getProperty(self): ... 
    #    s.t. Property is the name of the property you wish to use
    #  a getter for, with the first letter capitalized
    
    
    
    #getter for our users</div>
<div class="viewcode-block" id="gus_role.getUsers"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.gus_role.getUsers">[docs]</a>    def getUsers(self):
        """
        Return our users
        
        @rtype: django.contrib.auth.models.User
        @return: the value of our parent user
        """
        return self._role_users
    #getter for our user</div>
<div class="viewcode-block" id="gus_role.getGroup"><a class="viewcode-back" href="../../gus_roles.html#gus2.gus_roles.models.gus_role.getGroup">[docs]</a>    def getGroup(self):
        """
        Return our group
        
        @rtype: django.contrib.auth.models.User
        @return: the value of our parent user
        """
        return self._role_group
    
    #GETTER/SETTER enabled ... hackish
    #GETTERS AND SETTERS WILL BE USED (!Include simillar code in all classes)
    #getter and setter hooks , these must be setup if you wish to 
    #use gus_user.&lt;property&gt; = &lt;blah&gt;  or print gus_user.&lt;property&gt;
    # A Hack to make variables use setter
    
    #users hook</div>
    users = property(getUsers,setUsers)
    group = property(getGroup,setGroup)</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">gus v0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, The guspy Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>